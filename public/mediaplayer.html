<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>S0LACE • Media Player</title>

    <link rel="shortcut icon" content="favicon.ico" />
    <link rel="stylesheet" href="index.css" />

    <!-- BareMux + Epoxy + transport boot for Scramjet backend -->
    <script src="baremux/index.js"></script>
    <script src="epoxy/index.js"></script>
    <script src="transport-boot.js" defer></script>

    <!-- Service worker + your global stuff -->
    <script src="register-sw.js" defer></script>
    <script src="global-hub.js" defer></script>
  </head>

  <body class="media-player-page">
    <header class="site-header">
      <div class="site-title">
        S0LACE
      </div>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="games.html">Games</a>
        <a href="media.html" class="active">Media</a>
        <a href="apps.html">Apps</a>
        <a href="settings.html">Settings</a>
      </nav>
    </header>

    <main class="player-main">
      <div class="player-info">
        <div class="player-left">
          <span id="player-title">Loading…</span>
        </div>
        <div class="player-actions">
          <a href="media.html">← BACK TO MEDIA</a>
          <button id="open-new-tab">OPEN IN NEW TAB</button>
        </div>
      </div>

      <div class="player-frame-wrap">
        <iframe
          id="media-frame"
          src="about:blank"
          allowfullscreen
          allow="fullscreen; picture-in-picture; encrypted-media"
        ></iframe>
      </div>

      <div id="player-error" class="no-src" style="display:none;">
        No media URL provided.
      </div>
    </main>

    <script>
      (function () {
        const params = new URLSearchParams(window.location.search);
        const src = params.get("src");
        const title = params.get("title") || "Untitled";

        const frame = document.getElementById("media-frame");
        const titleEl = document.getElementById("player-title");
        const errorEl = document.getElementById("player-error");
        const frameWrap = document.querySelector(".player-frame-wrap");
        const openNewTabBtn = document.getElementById("open-new-tab");

        // Set title from query
        if (titleEl) {
          titleEl.textContent = title;
        }

        if (!src) {
          // nothing to load
          if (frameWrap) frameWrap.style.display = "none";
          if (errorEl) {
            errorEl.style.display = "flex";
            errorEl.textContent = "No media URL provided.";
          }
          return;
        }

        // Just iframe the src exactly as passed (already /scramjet/… from media.html)
        if (frame) {
          frame.src = src;
        }

        if (openNewTabBtn) {
          openNewTabBtn.addEventListener("click", () => {
            window.open(src, "_blank");
          });
        }
      })();
    </script>
  </body>
</html>
